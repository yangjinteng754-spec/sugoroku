<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã™ã”ã‚ã </title>
<style>
  body {
    font-family: "Segoe UI", sans-serif;
    background: #f4f6fa;
    margin: 0;
    padding: 0;
  }

  h1 {
    text-align: center;
    margin-top: 20px;
  }

  .container {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 15px;
  }

  .board {
    display: grid;
    grid-template-columns: repeat(10, 60px);
    gap: 8px;
    margin-top: 15px;
  }

  .cell {
    width: 60px;
    height: 60px;
    border-radius: 10px;
    background-color: #ffffff;
    border: 1px solid #ccc;
    display: flex;
    justify-content: center;
    align-items: center;
    font-weight: bold;
    position: relative;
    transition: background-color 0.2s;
  }

  /* ã‚¤ãƒ™ãƒ³ãƒˆè‰² */
  .cell.event-red { background-color: #f8d7da; }
  .cell.event-green { background-color: #d4efdf; }
  .cell.event-orange { background-color: #fae5d3; }
  .cell.event-blue { background-color: #d6eaf8; }
  .cell.event-purple { background-color: #e8daef; }
  .cell.event-gray { background-color: #e5e8e8; }

  .player {
    position: absolute;
    bottom: 5px;
    right: 5px;
    background: #007bff;
    color: white;
    font-size: 11px;
    border-radius: 50%;
    width: 20px;
    height: 20px;
    text-align: center;
    line-height: 20px;
  }

  .player.p2 { background: #28a745; } /* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2ã®è‰² */

  .controls {
    display: flex;
    gap: 10px;
    justify-content: center;
    margin-top: 10px;
  }

  input[type="text"] {
    padding: 6px 10px;
    border-radius: 6px;
    border: 1px solid #ccc;
    font-size: 14px;
  }

  button {
    background: #007bff;
    border: none;
    color: white;
    border-radius: 8px;
    padding: 8px 16px;
    cursor: pointer;
    font-size: 14px;
  }

  button:hover {
    background: #0056b3;
  }

  .log {
    margin-top: 10px;
    width: 90%;
    max-width: 700px;
    background: #fff;
    border-radius: 10px;
    padding: 10px;
    box-shadow: 0 0 5px rgba(0,0,0,0.1);
    max-height: 250px;
    overflow-y: auto;
  }

  .log-entry {
    border-bottom: 1px solid #eee;
    padding: 4px 0;
  }

  @media (max-width: 600px) {
    .board {
      grid-template-columns: repeat(5, 50px);
    }
  }
</style>
</head>
<body>

<h1>ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã™ã”ã‚ãï¼ˆãƒ©ãƒ³ãƒ€ãƒ ã‚¤ãƒ™ãƒ³ãƒˆï¼‰</h1>

<div class="container">
  <div class="controls">
    <input type="text" id="player1" placeholder="ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1">
    <input type="text" id="player2" placeholder="ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2">
    <button id="startBtn">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
    <button id="resetBtn">ãƒªã‚»ãƒƒãƒˆ</button>
  </div>

  <div id="turnText">ğŸ‘‰ ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1ã®ç•ªã§ã™</div>

  <div class="board" id="board"></div>

  <button id="rollBtn">ğŸ² ã‚µã‚¤ã‚³ãƒ­ã‚’æŒ¯ã‚‹</button>

  <div class="log" id="log">
    <strong>ğŸ“œ ã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§ï¼ˆãƒ©ãƒ³ãƒ€ãƒ ï¼‰</strong><br>
  </div>
</div>

<script>
  const board = document.getElementById("board");
  const log = document.getElementById("log");
  const rollBtn = document.getElementById("rollBtn");
  const startBtn = document.getElementById("startBtn");
  const resetBtn = document.getElementById("resetBtn");
  const turnText = document.getElementById("turnText");
  const player1Input = document.getElementById("player1");
  const player2Input = document.getElementById("player2");

  const cells = 30;
  let playerPositions = [0, 0];
  let turn = 0;
  let gameStarted = false;
  let events = {};
  // è¡¨ç¤ºã«ä½¿ã†ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åï¼ˆå…¥åŠ›ãŒãªã„å ´åˆã¯æ—¢å®šå€¤ï¼‰
  let playerNames = ["ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1", "ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2"];
  // å„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã€Œä¼‘ã¿ã€ã‚«ã‚¦ãƒ³ã‚¿ï¼ˆnã‚¿ãƒ¼ãƒ³ä¼‘ã¿ãŒã‚ã‚Œã° n > 0ï¼‰
  let skipTurns = [0, 0];

  const eventTemplates = [
    ["âš ï¸ ãƒ¡ãƒ¼ãƒ«ã‚’é–‹ã„ãŸï¼1ãƒã‚¹æˆ»ã‚‹", -1, false, false, "event-red"],
    ["ğŸ” å¼·ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼1ãƒã‚¹é€²ã‚€", +1, false, false, "event-green"],
    ["ğŸ“µ SNSã«ä½æ‰€å…¬é–‹ï¼æ¬¡ã®ã‚¿ãƒ¼ãƒ³ä¼‘ã¿", 0, true, false, "event-orange"],
    ["ğŸ² å®‰å…¨ã‚¢ãƒ—ãƒªï¼ã‚‚ã†ä¸€åº¦ã‚µã‚¤ã‚³ãƒ­", 0, false, true, "event-blue"],
    ["ğŸ’» ä¸æ­£ã‚µã‚¤ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ï¼2ãƒã‚¹æˆ»ã‚‹", -2, false, false, "event-red"],
    ["ğŸ§© ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è³ªå•å¿˜ã‚ŒãŸï¼1ã‚¿ãƒ¼ãƒ³ä¼‘ã¿", 0, true, false, "event-purple"],
    ["ğŸ•µï¸ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ¼æ´©ï¼1ãƒã‚¹æˆ»ã‚‹+æ¬¡ã‚¿ãƒ¼ãƒ³ä¼‘ã¿", -1, true, false, "event-gray"],
    ["âš¡ ã‚¦ã‚¤ãƒ«ã‚¹æ„ŸæŸ“ï¼æ¬¡ã‚¿ãƒ¼ãƒ³ä¼‘ã¿&ã‚µã‚¤ã‚³ãƒ­åŠåˆ†", 0, true, false, "event-gray"]
  ];

  function shuffle(array) {
    return array.sort(() => Math.random() - 0.5);
  }

  function generateRandomEvents() {
    const availablePositions = Array.from({ length: cells - 2 }, (_, i) => i + 1); // exclude 0, last
    const selected = shuffle(availablePositions).slice(0, 13);
    events = {};
    selected.forEach(pos => {
      const ev = eventTemplates[Math.floor(Math.random() * eventTemplates.length)];
      events[pos] = ev;
    });
  }

  function createBoard() {
    board.innerHTML = "";
    for (let i = 0; i < cells; i++) {
      const div = document.createElement("div");
      div.classList.add("cell");
      div.textContent = i;
      if (events[i]) div.classList.add(events[i][4]);
      board.appendChild(div);
    }
  }

  function renderPlayers() {
    // æ—¢å­˜ã®playerè¦ç´ ã‚’æ¶ˆã™
    document.querySelectorAll(".player").forEach(el => el.remove());
    playerPositions.forEach((pos, i) => {
      // ç¯„å›²ä¿è­·
      const safePos = Math.max(0, Math.min(cells - 1, pos));
      const playerEl = document.createElement("div");
      playerEl.className = "player";
      if (i === 1) playerEl.classList.add("p2"); // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2ã®è‰²ã‚’å¤‰ãˆã‚‹
      // è¡¨ç¤ºãƒ©ãƒ™ãƒ«ã¯åå‰ã®å…ˆé ­2æ–‡å­—ï¼ˆé•·ã„åå‰ã®ã¨ãã§ã‚‚çœç•¥ï¼‰
      const label = playerNames[i] ? playerNames[i].slice(0, 2) : String(i + 1);
      playerEl.textContent = label;
      // ãƒ•ãƒ«ãƒãƒ¼ãƒ ã‚’titleå±æ€§ã«å…¥ã‚Œã‚‹ï¼ˆãƒ›ãƒãƒ¼ã§ç¢ºèªã§ãã‚‹ï¼‰
      playerEl.title = playerNames[i];
      // boardã®å­è¦ç´ ãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèª
      if (board.children[safePos]) board.children[safePos].appendChild(playerEl);
    });
  }

  function addLog(text) {
    const entry = document.createElement("div");
    entry.classList.add("log-entry");
    entry.textContent = text;
    // æœ€æ–°ã‚’ä¸Šã«è¡¨ç¤ºï¼ˆ2ç•ªç›®ã«æŒ¿å…¥ã™ã‚‹ã¨è¦‹å‡ºã—ã‚’æ®‹ã›ã‚‹ï¼‰
    log.insertBefore(entry, log.children[1]);
  }

  function startGame() {
    // å…¥åŠ›ã•ã‚ŒãŸåå‰ã‚’åæ˜ ï¼ˆç©ºæ¬„ã¯æ—¢å®šå€¤ã‚’ä½¿ã†ï¼‰
    const p1 = player1Input.value.trim();
    const p2 = player2Input.value.trim();
    playerNames[0] = p1 || "ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1";
    playerNames[1] = p2 || "ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2";

    // å…¥åŠ›ã‚’ãƒ­ãƒƒã‚¯ï¼ˆé€”ä¸­ã§å¤‰ãˆãŸã„å ´åˆã¯ã“ã®2è¡Œã‚’å‰Šã£ã¦ã‚‚OKï¼‰
    player1Input.disabled = true;
    player2Input.disabled = true;

    generateRandomEvents();
    playerPositions = [0, 0];
    skipTurns = [0, 0]; // ä¼‘ã¿çŠ¶æ…‹ã‚’åˆæœŸåŒ–
    turn = 0;
    gameStarted = true;
    createBoard();
    renderPlayers();
    log.innerHTML = "<strong>ğŸ“œ ã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§ï¼ˆãƒ©ãƒ³ãƒ€ãƒ ï¼‰</strong><br>";
    Object.keys(events).sort((a,b)=>a-b).forEach(pos=>{
      addLog(`${pos}ãƒã‚¹: ${events[pos][0]}`);
    });
    addLog("ğŸ® ã‚²ãƒ¼ãƒ é–‹å§‹ï¼");
    turnText.textContent = `ğŸ‘‰ ${playerNames[0]}ã®ç•ªã§ã™`;
    rollBtn.disabled = false;
  }

  function resetGame() {
    // ã‚·ãƒ³ãƒ—ãƒ«ã«ãƒªãƒ­ãƒ¼ãƒ‰ï¼ˆå¿…è¦ãªã‚‰çŠ¶æ…‹ã‚’åˆæœŸåŒ–ã™ã‚‹å‡¦ç†ã«æ›¸ãæ›ãˆã‚‰ã‚Œã¾ã™ï¼‰
    location.reload();
  }

  function rollDice() {
    if (!gameStarted) {
      addLog("âš ï¸ å…ˆã«ã€Œã‚¹ã‚¿ãƒ¼ãƒˆã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚");
      return;
    }

    const player = turn;
    const name = playerNames[player] || `ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼${player + 1}`;

    // ä¼‘ã¿åˆ¤å®šï¼šskipTurns ãŒ 1 ä»¥ä¸Šãªã‚‰ãã®åˆ†ã®ã‚¿ãƒ¼ãƒ³ã‚’æ¶ˆè²»ã—ã¦é£›ã°ã™
    if (skipTurns[player] > 0) {
      skipTurns[player] -= 1;
      addLog(`${name}ã¯ä¼‘ã¿ï¼æ®‹ã‚Šä¼‘ã¿ã‚¿ãƒ¼ãƒ³: ${skipTurns[player]}`);
      // æ¬¡ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ã‚¿ãƒ¼ãƒ³ã‚’ç§»ã™
      turn = (turn + 1) % 2;
      turnText.textContent = `ğŸ‘‰ ${playerNames[turn]}ã®ç•ªã§ã™`;
      return;
    }

    const dice = Math.floor(Math.random() * 6) + 1;
    addLog(`${name}ã®ç•ª ğŸ² ${dice} ãŒå‡ºãŸï¼`);

    // ã‚µã‚¤ã‚³ãƒ­ã®çµæœã‚’é©ç”¨
    playerPositions[player] += dice;
    if (playerPositions[player] >= cells - 1) {
      playerPositions[player] = cells - 1;
      renderPlayers();
      addLog(`ğŸ ${name}ã®å‹ã¡ï¼`);
      rollBtn.disabled = true;
      return;
    }

    // ã‚¤ãƒ™ãƒ³ãƒˆåˆ¤å®š
    if (events[playerPositions[player]]) {
      const [msg, move, skip, extra, color] = events[playerPositions[player]];
      addLog(`${name}: ${msg}`);

      // ç§»å‹•åŠ¹æœï¼ˆæˆ»ã‚‹/é€²ã‚€ï¼‰
      playerPositions[player] += move;
      if (playerPositions[player] < 0) playerPositions[player] = 0;
      if (playerPositions[player] >= cells - 1) {
        playerPositions[player] = cells - 1;
        renderPlayers();
        addLog(`ğŸ ${name}ã®å‹ã¡ï¼`);
        rollBtn.disabled = true;
        return;
      }

      // ä¼‘ã¿åŠ¹æœï¼ˆskip ãŒ true ã®å ´åˆã€æ¬¡ã®ã‚¿ãƒ¼ãƒ³ã«ä¼‘ã¾ã›ã‚‹ï¼‰
      if (skip) {
        // ã“ã“ã§ã¯ã€Œæ¬¡ã®ã‚¿ãƒ¼ãƒ³1å›ä¼‘ã¿ã€ã‚’ã‚»ãƒƒãƒˆ
        skipTurns[player] += 1;
        addLog(`${name}ã¯æ¬¡ã®ã‚¿ãƒ¼ãƒ³ã‚’ä¼‘ã¿ã¾ã™ï¼ˆä¼‘ã¿ã‚«ã‚¦ãƒ³ãƒˆ: ${skipTurns[player]}ï¼‰`);
      }

      renderPlayers();

      // ã‚‚ã†ä¸€åº¦ã‚µã‚¤ã‚³ãƒ­ã‚’æŒ¯ã‚Œã‚‹åŠ¹æœï¼ˆextraï¼‰ãŒã‚ã‚Œã°ãã®ã¾ã¾åŒã˜ã‚¿ãƒ¼ãƒ³ç¶™ç¶š
      if (extra) {
        addLog(`${name}ã¯ã‚‚ã†ä¸€åº¦ã‚µã‚¤ã‚³ãƒ­ã‚’æŒ¯ã‚Œã¾ã™ï¼`);
        return;
      }
    }

    renderPlayers();

    // ã‚¿ãƒ¼ãƒ³äº¤ä»£
    turn = (turn + 1) % 2;
    turnText.textContent = `ğŸ‘‰ ${playerNames[turn]}ã®ç•ªã§ã™`;
  }

  // ã‚¤ãƒ™ãƒ³ãƒˆç™»éŒ²
  startBtn.addEventListener("click", startGame);
  resetBtn.addEventListener("click", resetGame);
  rollBtn.addEventListener("click", rollDice);

  // åˆæœŸãƒœãƒ¼ãƒ‰ç”Ÿæˆï¼ˆã¾ã ã‚²ãƒ¼ãƒ é–‹å§‹å‰ï¼‰
  createBoard();
  // ã‚µã‚¤ã‚³ãƒ­ã¯ã‚¹ã‚¿ãƒ¼ãƒˆå‰ã«æŠ¼ã—ã¦ã‚‚æ„å‘³ãŒãªã„ã®ã§ç„¡åŠ¹åŒ–ã—ã¦ãŠãï¼ˆstartæ™‚ã«æœ‰åŠ¹åŒ–ï¼‰
  rollBtn.disabled = true;
</script>

</body>
</html>